<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Список туров</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link th:href="@{/public/tourList.css}" rel="stylesheet">
   <link th:href="@{/public/iframe.css}" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
</head>

<body class="bg-light">

  <!-- Навигация и баннер -->
  <iframe id="banner-frame" th:src="@{/banner}" width="100%" scrolling="no" style="border: none; display: block;"></iframe>
  <iframe id="navbar-frame" th:src="@{/navbar}" width="100%" style="border: none; display: block;"></iframe>

  <!-- Поисковая форма -->
 <!--  <section class="container my-4">
    <div class="card shadow-sm p-4">
      <form th:action="@{/tours/search}" method="get" class="row g-3">
        <div class="col-md-4">
          <input type="text" class="form-control" name="tour" placeholder="Название тура или город">
        </div>
        <div class="col-md-3">
          <input type="date" class="form-control" name="startDate">
        </div>
        <div class="col-md-3">
          <select name="guests" class="form-select">
            <option value="2">На 2 гостей</option>
            <option value="3">На 3 гостей</option>
            <option value="4">На 4 гостей</option>
          </select>
        </div>
        <div class="col-md-2 d-grid">
          <button type="submit" class="btn btn-primary">Поиск</button>
        </div>
      </form>
    </div>
  </section> -->

  <!-- Поисковая форма(расширенная) -->
  <section class="container my-4">
  <div class="card shadow-sm p-4">
    <form th:action="@{/tours/search}" method="get" class="row g-3">
      <!-- Страна -->
      <div class="col-md-3">
        <input type="text" class="form-control" name="country" placeholder="Страна назначения">
      </div>
      
      <!-- Город вылета -->
      <div class="col-md-3">
        <input type="text" class="form-control" name="departureCity" placeholder="Город вылета">
      </div>
      
      <!-- Дата начала поездки -->
      <div class="col-md-2">
        <input type="date" class="form-control" name="startDate">
      </div>

      <!-- Количество гостей -->
      <div class="col-md-2">
        <select name="guests" class="form-select">
          <option disabled selected>Количество гостей</option>
          <option value="1">1 гость</option>
          <option value="2">2 гостя</option>
          <option value="3">3 гостя</option>
          <option value="4">4 гостя</option>
          <option value="5">5 и более</option>
        </select>
      </div>

      <!-- Бюджет -->
      <div class="col-md-2">
        <input type="number" class="form-control" name="budget" placeholder="Бюджет, ₽">
      </div>

      <!-- Кнопка поиска -->
      <div class="col-12 d-grid">
        <button type="submit" class="btn btn-primary">Поиск</button>
      </div>
    </form>
  </div>
</section>


  <!-- Список туров -->
  <div class="container">
    <h2 class="text-center my-4">Доступные туры</h2>

    <div class="row row-cols-1 row-cols-md-2 g-4">
      <div class="col" th:each="tour : ${tours}">
        <div class="card h-100 shadow-sm">
         <div class="card-body">
  <h5 class="card-title">
    <span th:text="${tour.name}"></span>
    <span th:if="${tour.isArchived}" class="badge bg-secondary ms-2">Архив</span>
  </h5>

  <p class="card-text mb-1">
    <i class="bi bi-calendar-event"></i>
    <strong> Даты тура:</strong>
    <span th:text="${#temporals.format(tour.startDate, 'dd.MM.yyyy')}"></span> –
    <span th:text="${#temporals.format(tour.endDate, 'dd.MM.yyyy')}"></span>
  </p>

  <p class="card-text mb-1">
    <i class="bi bi-people"></i>
    <strong> Свободных мест:</strong> <span th:text="${tour.availableSpots}"></span>
  </p>

  <p class="card-text mb-1" th:if="${tour.hotel != null}">
    <i class="bi bi-building"></i>
    <strong> Отель:</strong> <span th:text="${tour.hotel.name}"></span>
  </p>

  <p class="card-text mb-1" th:if="${tour.room != null}">
    <i class="bi bi-door-open"></i>
    <strong> Комната:</strong> <span th:text="${tour.room.description}"></span>
  </p>

  <p class="card-text mb-1" th:if="${tour.trainTickets != null and !#lists.isEmpty(tour.trainTickets)}">
    <i class="bi bi-train-front"></i>
    <strong> Поезда:</strong>
    <span th:each="ticket, iterStat : ${tour.trainTickets}">
      <span th:text="${ticket.trainNumber}"></span><span th:if="${!iterStat.last}">, </span>
    </span>
  </p>

  <p class="card-text mb-1" th:if="${tour.flights != null and !#lists.isEmpty(tour.flights)}">
    <i class="bi bi-airplane"></i>
    <strong> Перелёты:</strong>
    <span th:each="flight, iterStat : ${tour.flights}">
      <span th:text="${flight.flightNumber}"></span><span th:if="${!iterStat.last}">, </span>
    </span>
  </p>

  <p class="card-text mb-1" th:if="${tour.comments != null and !#lists.isEmpty(tour.comments)}">
    <i class="bi bi-chat-left-text"></i>
    <strong> Комментарии:</strong> <span th:text="${tour.comments.size()} + ' отзывов'"></span>
  </p>

  <p class="card-text mb-1">
    <i class="bi bi-currency-ruble"></i>
    <strong> Цена:</strong> <span th:text="${tour.price} + ' руб.'"></span>
  </p>


 <ul class="list-unstyled mt-2" th:if="${!#lists.isEmpty(tour.excursions)}">
    <li th:each="excursion : ${tour.excursions}">
      <i class="bi bi-map"></i> Экскурсия: <span th:text="${excursion.title}"></span>
    </li>
  </ul>
</div>


  <p class="card-text">
    <i class="bi bi-info-circle"></i>
    <span th:text="${tour.description}">Описание тура</span>
  </p>

 

          <div class="card-footer bg-white d-flex justify-content-around">
            <a th:href="@{'/tours/details/' + ${tour.tourId}}" class="btn btn-outline-primary btn-sm">Подробнее</a>
            <a th:href="@{'/tours/edit/' + ${tour.tourId}}" class="btn btn-outline-warning btn-sm"
              th:if="${roles.contains('ROLE_ADMIN')}">Редактировать</a>
            <a th:href="@{'/tours/delete/' + ${tour.tourId}}" class="btn btn-outline-danger btn-sm"
              th:if="${roles.contains('ROLE_ADMIN')}">Удалить</a>
          </div>
        </div>
      </div>
    </div>

    <!-- Кнопки -->
    <div class="text-center my-4">
      <a th:href="@{'/tours/new'}" th:if="${roles.contains('ROLE_ADMIN')}" class="btn btn-success me-2">Добавить тур</a>
      <a th:href="@{'/tours/custom'}" class="btn btn-primary">Создать собственный тур</a>
    </div>

    <!-- Пагинация -->
    <nav th:if="${pagesCount > 1}">
      <ul class="pagination justify-content-center">
        <li class="page-item" th:each="i : ${#numbers.sequence(1, pagesCount)}">
          <a class="page-link" th:href="@{/tours(page=${i})}" th:text="${i}"></a>
        </li>
      </ul>
    </nav>
  </div>

  <!-- Подвал -->
  <iframe id="footer-frame" th:src="@{/footer}" width="100%" style="border: none; display: block; margin-top: 40px;"></iframe>

  <!-- JS -->
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.0.8/dist/umd/popper.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <script src="/public/js/scripts.js"></script>

</body>
</html>
