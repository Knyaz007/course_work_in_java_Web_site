<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8" />
    <title>Edit Tour</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    
</head>

<body class="bg-light">

    <div class="container my-5">
        <h2 class="mb-4">Edit Tour</h2>

        <form th:action="@{/tours/edit/{id}(id=${tour.tourId})}" method="post" th:object="${tour}" class="card p-4 shadow-sm bg-white">
            <div th:if="${#fields.hasErrors('*')}" class="alert alert-danger">
                <p th:each="error : ${#fields.errors('*')}" th:text="${error}"></p>
            </div>

            <div class="mb-3">
                <label for="name" class="form-label">Name:</label>
                <input type="text" id="name" class="form-control" th:field="*{name}" />
            </div>

            <div class="mb-3">
                <label for="description" class="form-label">Description:</label>
                <textarea id="description" class="form-control" th:field="*{description}"></textarea>
            </div>

            <div class="mb-3">
                <label for="price" class="form-label">Price:</label>
                <input type="number" step="0.01" id="price" class="form-control" th:field="*{price}" />
            </div>

            <div class="mb-3 row">
                <div class="col-md-6">
                    <label for="startDate" class="form-label">Start Date:</label>
                    <input type="date" id="startDate" class="form-control" th:field="*{startDate}" />
                </div>
                <div class="col-md-6">
                    <label for="endDate" class="form-label">End Date:</label>
                    <input type="date" id="endDate" class="form-control" th:field="*{endDate}" />
                </div>
            </div>

            <div class="mb-3">
                <label for="availableSpots" class="form-label">Available Spots:</label>
                <input type="number" id="availableSpots" class="form-control" th:field="*{availableSpots}" />
            </div>

            <!-- Hotel Select -->
            <div class="mb-3">
                <label for="hotel" class="form-label">Отель:</label>
                <select id="hotel" name="hotelId" class="form-select" onchange="filterRoomsByHotel(this); showHotelInfo(this);">
                    <option value="" disabled selected>Выберите отель</option>
                    <option th:each="hotel : ${hotels}"
                            th:value="${hotel.id}"
                            th:selected="${tour.hotel != null} ? ${hotel.id} == ${tour.hotel.id} : false"
                            th:data-name="${hotel.name}"
                            th:data-country="${hotel.country}"
                            th:data-region="${hotel.region}"
                            th:data-city="${hotel.city}"
                            th:data-street="${hotel.street}"
                            th:data-house="${hotel.house}"
                            th:data-type="${hotel.type}"
                            th:data-rooms="${hotel.availableRooms}"
                            th:text="${hotel.name}">
                    </option>
                </select>
            </div>

            <div id="hotel-info" class="border rounded p-3 mb-3 bg-light" style="display: none;">
                <p><strong>Название:</strong> <span id="hotel-name"></span></p>
                <p><strong>Адрес:</strong> <span id="hotel-address"></span></p>
                <p><strong>Тип:</strong> <span id="hotel-type"></span></p>
                <p><strong>Доступные комнаты:</strong> <span id="hotel-rooms"></span></p>
            </div>




            

            <!-- Room Select -->
            <div class="mb-3">
                <label for="room" class="form-label">Комната:</label>
                <select id="room" name="roomId" class="form-select" onchange="showRoomInfo(this)">
                    <option value="" disabled selected>Выберите комнату</option>
                    <option th:each="room : ${rooms}"
                            th:value="${room.id}"
                            th:selected="${tour.room != null} ? ${room.id} == ${tour.room.id} : false"
                            th:data-hotel-id="${room.hotel.id}"
                            th:data-number="${room.roomNumber}"
                            th:data-capacity="${room.thingsRoom.size()}"
                            th:data-type="${room.description}"
                            th:data-price="${room.price}"
                            th:text="'Комната ' + ${room.roomNumber} + ' | Цена: ' + ${room.price} + '₽'">
                    </option>
                </select>
            </div>

            <div id="room-info" class="border rounded p-3 mb-3 bg-light" style="display: none;">
                <p><strong>Номер:</strong> <span id="room-number"></span></p>
                <p><strong>Вместимость:</strong> <span id="room-capacity"></span></p>
                <p><strong>Тип:</strong> <span id="room-type"></span></p>
                <p><strong>Цена за ночь:</strong> <span id="room-price"></span></p>
            </div>

            <!-- Flight Select -->
            <div class="mb-3">
                <label for="flight" class="form-label">Рейсы:</label>
                <select id="flight" name="flightId" multiple class="form-select">
                    <option th:each="flight : ${flights}"
                            th:value="${flight.flightId}"
                            th:selected="${tour.flights != null} ? ${tour.flights.contains(flight)} : false"
                            th:text="${flight.flightNumber + ' | ' + flight.departure + ' → ' + flight.destination + ' | ' + #temporals.format(flight.departureDate, 'dd.MM.yyyy')}">
                    </option>
                </select>
            </div>

            <!-- Train Ticket Select -->
            <div class="mb-3">
                <label for="trainTicket" class="form-label">Билеты на поезд:</label>
                <select id="trainTicket" name="trainTicketId" multiple class="form-select" onchange="filterCarriagesByTicket(this); showTrainTicketInfo(this);">
                    <option th:each="ticket : ${trainTickets}"
                            th:value="${ticket.ticketId}"
                            th:selected="${tour.trainTickets != null} ? ${tour.trainTickets.contains(ticket)} : false"
                            th:text="'Поезд №' + ${ticket.trainNumber} + ' | ' + ${ticket.departureCity} + ' → ' + ${ticket.destinationCity}">
                    </option>
                </select>
            </div>

            <!-- Carriage Select -->
            <div class="mb-3">
                <label for="carriage" class="form-label">Вагон:</label>
                <select id="carriage" name="carriageId" class="form-select" onchange="showCarriageInfo(this)">
                    <option value="" disabled selected>Выберите вагон</option>
                    <option th:each="carriage : ${carriages}"
                            th:value="${carriage.carriageInfoId}"
                            th:data-train-ticket-id="${carriage.trainTicket.ticketId}"
                            th:data-type="${carriage.type}"
                            th:data-seats="${carriage.availableSeats}"
                            th:data-price="${carriage.minPrice}"
                            th:data-seat-type="${carriage.seatType}"
                            th:data-ticket-class="${carriage.ticketClass}"
                            th:text="'Тип: ' + ${carriage.type} + ', Цена от: ' + ${carriage.minPrice} + '₽'">
                    </option>
                </select>
            </div>

            <div id="carriage-info" class="border rounded p-3 mb-3 bg-light" style="display: none;">
                <!-- Здесь будет info -->
            </div>

            <button type="submit" class="btn btn-success w-100">Сохранить изменения</button>
        </form>

        <div class="text-center mt-4">
            <a href="/" class="btn btn-outline-primary">На главную</a>
        </div>
    </div>

    <script src="/public/js/tourNew.js"></script>
 
    <!-- В конце <body> -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
    tooltipTriggerList.forEach(function (tooltipTriggerEl) {
      new bootstrap.Tooltip(tooltipTriggerEl)
    })
  });
</script>

</body>
</html>
