<!DOCTYPE html>
<html lang="ru" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Детали тура</title>

  <link th:href="@{/public/tourDetails.css}" rel="stylesheet" />
  <link th:href="@{/public/iframe.css}" rel="stylesheet" />
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.9.1/font/bootstrap-icons.css" rel="stylesheet" />
  
  <style>
    .readonly {
      background-color: #f8f9fa;
      padding: 8px 12px;
      border-radius: 4px;
      border: 1px solid #ced4da;
      min-height: 38px;
      margin-bottom: 10px;
    }
    label {
      font-weight: 600;
    }
  </style>
</head>
<body>

<iframe id="banner-frame" th:src="@{/banner}" width="100%" scrolling="no" style="border: none; display: block;"></iframe>
<iframe id="navbar-frame" th:src="@{/navbar}" width="100%" style="border: none; display: block;"></iframe>

<div class="container my-4">
  <h2 class="mb-4 text-primary border-bottom pb-2">Детали тура</h2>

  <form th:object="${tour}" th:action="@{/tours/details}" method="post" class="bg-light p-4 rounded shadow-sm">

    <div class="row">
      <div class="col-md-6">

       <!--  <div class="form-group row">
          <label class="col-sm-4 col-form-label text-secondary">ID тура:</label>
          <div class="col-sm-8 align-self-center text-dark" th:text="${tour.tourId}"></div>
        </div> -->

        <div class="form-group row">
          <label class="col-sm-4 col-form-label text-secondary">Название:</label>
          <div class="col-sm-8 align-self-center h5 text-success" th:text="${tour.name}"></div>
        </div>

        <!--
        <div class="form-group row">
          <label class="col-sm-4 col-form-label text-secondary">Категория:</label>
          <div class="col-sm-8 align-self-center" th:text="${tour.category} ?: 'Не указано'"></div>
        </div>

        <div class="form-group row">
          <label class="col-sm-4 col-form-label text-secondary">Статус:</label>
          <div class="col-sm-8 align-self-center" th:text="${tour.status} ?: 'Неизвестно'"></div>
        </div>
        -->

        <div class="form-group row">
          <label class="col-sm-4 col-form-label text-secondary">Описание:</label>
          <div class="col-sm-8 align-self-center text-justify" th:text="${tour.description}"></div>
        </div>

        <div class="form-group row">
          <label class="col-sm-4 col-form-label text-secondary">Цена:</label>
          <div class="col-sm-8 align-self-center h5 text-danger" th:text="${tour.price} + ' руб.'"></div>
        </div>

        <!--
        <div class="form-group row">
          <label class="col-sm-4 col-form-label text-secondary">Продолжительность:</label>
          <div class="col-sm-8 align-self-center" th:text="${tour.durationDays} + ' дней'"></div>
        </div>
        -->

        <div class="form-group row">
          <label class="col-sm-4 col-form-label text-secondary">Дата начала:</label>
          <div class="col-sm-8 align-self-center" th:text="${#temporals.format(tour.startDate, 'dd.MM.yyyy')}"></div>
        </div>

        <div class="form-group row">
          <label class="col-sm-4 col-form-label text-secondary">Дата окончания:</label>
          <div class="col-sm-8 align-self-center" th:text="${#temporals.format(tour.endDate, 'dd.MM.yyyy')}"></div>
        </div>

      </div>

      <div class="col-md-6">

        <div class="form-group row">
          <label class="col-sm-4 col-form-label text-secondary">Доступные места:</label>
          <div class="col-sm-8 align-self-center" th:text="${tour.availableSpots}"></div>
        </div>

        <!-- Отель -->
        <div class="form-group" th:if="${tour.hotel != null}">
          <label class="font-weight-bold text-secondary">Отель:</label>
          <div class="bg-white p-3 rounded shadow-sm mb-3">
            <h5 class="text-primary mb-1" th:text="${tour.hotel.name}"></h5>
            <p class="mb-1 text-muted">
              <span th:text="${tour.hotel.country} + ', '"></span>
              <span th:text="${tour.hotel.region} + ', '"></span>
              <span th:text="${tour.hotel.city} + ', '"></span>
              <span th:text="${tour.hotel.street} + ' '"></span>
              <span th:text="${tour.hotel.house}"></span>
            </p>

            <div th:if="${tour.hotel.services != null and !tour.hotel.services.isEmpty()}">
              <label class="font-weight-bold text-secondary">Услуги отеля:</label>
              <ul class="list-inline">
                <li class="list-inline-item badge badge-info mr-1" th:each="service : ${tour.hotel.services}" th:text="${service.name}"></li>
              </ul>
            </div>
          </div>
        </div>

        <!-- Номер -->
        <div class="form-group" th:if="${tour.room != null}">
          <label class="font-weight-bold text-secondary">Номер:</label>
          <div class="bg-white p-3 rounded shadow-sm text-dark" th:text="${tour.room.description}"></div>
          <!-- <div class="readonly" th:text="'Макс. гостей: ' + ${tour.room.maxGuests}"></div> -->
        </div>

        <!-- Транспорт -->
        <!--
        <div class="form-group" th:if="${tour.transport != null}">
          <label>Транспорт:</label>
          <div class="readonly" th:text="${tour.transport}"></div>
        </div>
        -->

      </div>
    </div>

    <!-- Перелёты -->
    <div class="form-group" th:if="${tour.flights != null and !tour.flights.isEmpty()}">
      <label>Перелёты:</label>
      <ul>
        <li th:each="flight : ${tour.flights}">
          <strong th:text="${flight.flightNumber}">SU123</strong>
          <span>
            (Откуда: <span th:text="${flight.departure}">Москва</span>, аэропорт <span th:text="${flight.departureAirport}">Шереметьево</span>)
            →
            (Куда: <span th:text="${flight.destination}">Санкт-Петербург</span>, аэропорт <span th:text="${flight.arrivalAirport}">Пулково</span>)
          </span>
          <br/>
          <span>
            Дата и время отправления:
            <span th:text="${#temporals.format(flight.departureDate, 'dd.MM.yyyy')}"></span>
            <span th:text="${flight.departureTime}"></span>
          </span>
          <br/>
          <span>
            Дата и время прибытия:
            <span th:text="${#temporals.format(flight.arrivalDate, 'dd.MM.yyyy')}"></span>
            <span th:text="${flight.arrivalTime}"></span>
          </span>
          <br/>
          <span>Длительность полёта: <span th:text="${flight.flightTime}"></span> ч.</span><br/>
          <span>Цена билета: <span th:text="${flight.price}"></span> руб.</span><br/>
          <!-- <span>Свободные места: <span th:text="${flight.availableSeats}"></span></span><br/> -->
          <span th:if="${flight.wifiAvailability}">Wi-Fi на борту: есть</span>
          <span th:unless="${flight.wifiAvailability}">Wi-Fi на борту: нет</span><br/>
          <span>Методы оплаты: <span th:text="${flight.availablePaymentMethods}"></span></span><br/>
          <span>Условия провоза животных: <span th:text="${flight.petPolicy}"></span></span>
        </li>
      </ul>
    </div>

    <!-- Ж/д билеты -->
    <div class="form-group" th:if="${tour.trainTickets != null and !tour.trainTickets.isEmpty()}">
      <label>Ж/д билеты:</label>
      <ul>
        <li th:each="ticket : ${tour.trainTickets}">
          <strong th:text="${ticket.trainNumber}">№ поезда</strong>
          <span>
            (Откуда: <span th:text="${ticket.departureCity}">Город отправления</span>, станция: <span th:text="${ticket.departureStation}">Станция отправления</span>)
            →
            (Куда: <span th:text="${ticket.destinationCity}">Город прибытия</span>, станция: <span th:text="${ticket.destinationStation}">Станция прибытия</span>)
          </span>
          <br/>
          <span>
            Дата и время отправления:
            <span th:text="${#temporals.format(ticket.departureDate, 'dd.MM.yyyy')}"></span>
            <span th:text="${ticket.departureTime}"></span>
          </span>
          <br/>
          <span>
            Дата и время прибытия:
            <span th:text="${#temporals.format(ticket.arrivalDate, 'dd.MM.yyyy')}"></span>
            <span th:text="${ticket.arrivalTime}"></span>
          </span>
          <br/>
          <span>Цена: <span th:text="${ticket.price}"></span> руб.</span><br/>
          <span th:if="${ticket.wifiAvailability}">Wi-Fi в поезде: есть</span>
          <span th:unless="${ticket.wifiAvailability}">Wi-Fi в поезде: нет</span><br/>
          <span>Методы оплаты: <span th:text="${ticket.availablePaymentMethods}"></span></span><br/>
          <span>Правила провоза багажа: <span th:text="${ticket.luggagePolicy}"></span></span><br/>
          <span>Правила провоза животных: <span th:text="${ticket.petPolicy}"></span></span>

          <!-- Дополнительно, если хочешь показать вагоны -->
          <div th:if="${ticket.carriages != null and !ticket.carriages.isEmpty()}">
            <label>Вагоны:</label>
            <ul>
              <li th:each="carriage : ${ticket.carriages}" th:text="${carriage.type}"></li>
            </ul>
          </div>
        </li>
      </ul>
    </div>

    <!-- Экскурсии -->
    <ul class="list-unstyled mt-2" th:if="${!#lists.isEmpty(tour.excursions)}">
      <li th:each="excursion : ${tour.excursions}" class="border p-3 mb-2 rounded shadow-sm">
        <h5 th:text="${excursion.title}"></h5>
        <p th:text="${excursion.description}"></p>
        <p>
          <span th:text="${excursion.city}">Город</span>, 
          <span th:text="${excursion.country}">Страна</span> |
          <span th:text="${#temporals.format(excursion.dateTime, 'dd.MM.yyyy HH:mm')}">Дата и время</span> |
          <strong th:text="${excursion.price} + ' руб.'">Цена</strong>
        </p>
      </li>
    </ul>

  </form>

  <a th:href="@{'/tours/edit/' + ${tour.tourId}}" class="btn btn-primary mt-3" th:if="${roles.contains('ROLE_ADMIN')}">Редактировать</a>

  <a href="/" style="text-decoration: none;">
    <button type="button" class="btn btn-secondary mt-3">Вернуться к главной форме</button>
  </a>

  <form th:action="@{/tours/bookingTour}" method="post" class="mt-3">
    <input type="hidden" name="tourId" th:value="${tour.tourId}" />
    <button type="submit" name="action" value="book" class="btn btn-success">Забронировать</button>
  </form>
</div>

<iframe id="footer-frame" th:src="@{/footer}" width="100%" style="border: none; display: block;"></iframe>

<script src="/public/js/scripts.js"></script>
</body>
</html>
