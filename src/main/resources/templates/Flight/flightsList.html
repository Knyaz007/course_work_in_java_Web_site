<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Список рейсов</title>

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link th:href="@{/public/flights.css}" rel="stylesheet"/>
    <link th:href="@{/public/iframe.css}" rel="stylesheet"/>
    <style> 
    #footer-frame {
  height: 200px;
  background-color: red;
}

</style>
</head>
<body>

<!-- Вставка баннера и навбара -->
<iframe id="banner-frame" th:src="@{/banner}" width="100%" scrolling="no" style="border: none; display: block;"></iframe>
<iframe id="navbar-frame" th:src="@{/navbar}" width="100%" style="border: none; display: block;"></iframe>

<div class="container mt-4">

    <div id="formAlert" class="alert alert-warning alert-dismissible fade show d-none" role="alert">
    Пожалуйста, заполните хотя бы одно поле для поиска.
    <button type="button" class="close" data-dismiss="alert" aria-label="Закрыть">
        <span aria-hidden="true">&times;</span>
    </button>
</div>

   <!-- Поисковая форма -->
<form action="/flights/search" method="get" class="border p-4 rounded bg-light" onsubmit="return validateCities()">
  <div class="form-row">
    <div class="form-group col-md-3">
      <label for="origin">Откуда</label>
      <input type="text" class="form-control" id="origin" name="origin" placeholder="Введите город отправления">
    </div>
    <div class="form-group col-md-3">
      <label for="destination">Куда</label>
      <input type="text" class="form-control" id="destination" name="destination" placeholder="Введите город назначения">
    </div>
    <div class="form-group col-md-3">
      <label for="departureDate">Дата отправления</label>
      <input type="date" class="form-control" id="departureDate" name="departureDate">
    </div>
    <div class="form-group col-md-3">
      <label for="arrivalDate">Дата прибытие</label>
      <input type="date" class="form-control" id="arrivalDate" name="arrivalDate">
    </div>
  </div>
  <button type="submit" class="btn btn-primary">Найти рейс</button>
</form>

<!-- Модальное окно Bootstrap -->
<div class="modal fade" id="errorModal" tabindex="-1" role="dialog" aria-labelledby="errorModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header bg-danger text-white">
        <h5 class="modal-title" id="errorModalLabel">Ошибка</h5>
        <button type="button" class="close text-white" data-dismiss="modal" aria-label="Закрыть">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        Пожалуйста, введите хотя бы одно из полей: «Откуда» или «Куда».
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Ок</button>
      </div>
    </div>
  </div>
</div>

<!-- JS скрипт -->
<script>
  function validateCities() {
    const origin = document.getElementById("origin").value.trim();
    const destination = document.getElementById("destination").value.trim();

    if (!origin && !destination) {
      $('#errorModal').modal('show'); // Показываем модалку
      return false; // Остановить отправку формы
    }
    return true;
  }
</script>

<script>
    document.querySelector("form").addEventListener("submit", function (e) {
        const origin = document.getElementById("origin").value.trim();
        const destination = document.getElementById("destination").value.trim();
        const departureDate = document.getElementById("departureDate").value;
        const arrivalDate = document.getElementById("arrivalDate").value;
        const alertBox = document.getElementById("formAlert");

        // Скрыть предыдущее предупреждение
        alertBox.classList.add("d-none");

        if (!origin && !destination && !departureDate && !arrivalDate) {
            e.preventDefault();
            alertBox.classList.remove("d-none");
        }
    });
</script>


    <!-- Таблица с рейсами -->
    <div class="mt-5">
        <h2>Список рейсов</h2>
        <table th:if="${flights != null and #lists.size(flights) > 0}" class="table table-bordered table-hover mt-3">
            <thead class="thead-dark">
                <tr>
                    <th>Номер рейса</th>
                    <th>Откуда</th>
                    <th>Куда</th>
                    <th>Дата отправления</th>
                    <th>Время отправления</th>
                    <th>Дата прибытия</th>
                    <th>Время прибытия</th>
                    <th>Места</th>
                    <th>Цена</th>
                    <th>Wi-Fi</th>
                    <th>Животные</th>
                    <th>Действия</th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="flight : ${flights}">
                    <td th:text="${flight.flightNumber}"></td>
                    <td th:text="${flight.departure}"></td>
                    <td th:text="${flight.destination}"></td>
                    <td th:text="${#temporals.format(flight.departureDate, 'yyyy-MM-dd')}"></td>
                    <td th:text="${#temporals.format(flight.departureTime, 'HH:mm')}"></td>
                    <td th:text="${#temporals.format(flight.arrivalDate, 'yyyy-MM-dd')}"></td>
                    <td th:text="${#temporals.format(flight.arrivalTime, 'HH:mm')}"></td>
                    <td th:text="${flight.availableSeats}"></td>
                    <td th:text="${flight.price} + ' ₽'"></td>
                    <td th:text="${flight.wifiAvailability ? 'Есть' : 'Нет'}"></td>
                    <td th:text="${flight.petPolicy}"></td>
                    <td>
                        <a th:href="@{'/flights/details/' + ${flight.flightId}}" class="btn btn-info btn-sm">Подробнее</a>
                        <a th:href="@{'/flights/edit/' + ${flight.flightId}}" th:if="${roles.contains('ROLE_ADMIN')}" class="btn btn-warning btn-sm">Редактировать</a>
                        <a th:href="@{'/flights/delete/' + ${flight.flightId}}" th:if="${roles.contains('ROLE_ADMIN')}" class="btn btn-danger btn-sm">Удалить</a>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

     

    
</div>

<div class="mt-4" th:if="${roles.contains('ROLE_ADMIN')}">
        <a th:href="@{'/flights/new'}" class="btn btn-success">Добавить новый рейс</a>
        <a th:href="@{'/flights/import'}" class="btn btn-secondary ml-2">Импортировать рейсы</a>
</div>

<!-- Подвал -->
<iframe id="footer-frame" th:src="@{/footer}" width="100%" style="border: none; display: block; margin-top: 40px;"></iframe>

<!-- JS скрипты -->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.0.8/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script src="/public/js/scripts.js"></script>

</body>
</html>
