<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="UTF-8" />
  <title>Список отелей</title>
  <!-- Подключаем Bootstrap CSS -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <link th:href="@{/public/hotel.css}" rel="stylesheet" />
  <!-- для отображения звёзд: -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <style>

    
    .hotel-section {
      margin-bottom: 30px;
      padding: 20px;
      border: 1px solid #ddd;
      border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
      background-color: #fff;
      transition: transform 0.2s ease;
    }

    .hotel-section:hover {
      transform: translateY(-4px);
    }

    /* Фото */
    .photo-carousel {
      position: relative;
      max-width: 100%;
      margin-bottom: 15px;
      overflow: hidden;
      border-radius: 8px;
    }

    .photo-container img {
      width: 100%;
      height: auto;
      display: block;
      border-radius: 8px;
    }

    /* Стрелки */
    .arrow {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      font-size: 2rem;
      color: white;
      background: rgba(0, 0, 0, 0.4);

      cursor: pointer;
      user-select: none;
      z-index: 1;
      border-radius: 50%;
    }

    .arrow.left {
      left: 10px;
    }

    .arrow.right {
      right: 10px;
    }

    /* Описание */
    .hotel-description h3 {
      margin-top: 10px;
      font-size: 1.5rem;
      color: #333;
    }

    .hotel-description p {
      color: #666;
      font-size: 1rem;
    }

    /* Услуги */


    .services ul {
      padding-left: 20px;
      list-style: disc;
    }

    .services li {
      color: #444;
      font-size: 0.95rem;
    }

    /* Оценка */
    .fa-star,
    .fa-star-half-alt,
    .fa-star-o {
      color: #f5c518;
      margin-right: 2px;
    }

    /* Цена */
    .price h4 {
      margin-top: 15px;
      font-weight: 600;
    }

    .price h3 {
      font-size: 1.25rem;
      color: #2c3e50;
    }

    /* Админ кнопки */
    .actions {
      margin-top: 10px;
    }

    .actions .btn {
      margin-right: 5px;
    }

    /* Кнопка добавления */
    .btn-success.mt-3 {
      margin-top: 40px;
    }

 
    .rating-box {
  background-color: transparent;
  box-shadow: none;
  border-radius: 0;
  padding: 0;
  font-size: 0.95rem;
  text-align: center;
}


    .price {
      display: flex;
      flex-direction: column;

      border: 1px solid #ccc;
      padding: 10px;
    }

    .price-bottom {
      margin-top: auto;
      /* отправляет блок вниз */
    }
  </style>


</head>

<body>

  <!-- Баннер -->
  <iframe id="banner-frame" th:src="@{/banner}" width="100%" scrolling="no"
    style="border: none; display: block;"></iframe>

  <!-- Навигационная панель -->
  <iframe id="navbar-frame" th:src="@{/navbar}" width="100%" style="border: none; display: block;"></iframe>

  <!-- Форма поиска отелей -->
  <div id="search-form-container">
    <div class="sfl-container sfl-layout-default sfl-theme-16886-xroomhotel" data-version="1.5">
      <div class="sf-wrapper">
        <div class="sf-controls-wrapper">

          <!-- Город -->
          <div class="sf-field-container sf-arrival-date-container">
            <div class="sf-field-label sf-arrival-date-label">Куда вы хотите?</div>
            <div class="input-with-datalist">
              <input list="citiesSelect" id="Region" name="myCity" placeholder="Введите город или страну">
              <datalist id="citiesSelect" onchange="updateInputValue()">
                <option th:each="hotel : ${hotels}" th:value="${hotel.city}"></option>
              </datalist>
            </div>
          </div>

          <!-- Дата заезда -->
          <div class="sf-field-container sf-arrival-date-container">
            <div class="sf-field-label sf-arrival-date-label">Заезд</div>
            <input type="date" id="arrivalDate">
          </div>

          <!-- Дата выезда -->
          <div class="sf-field-container sf-departure-date-container">
            <div class="sf-field-label sf-departure-date-label">Выезд</div>
            <input type="date" id="arrivalDate2">
          </div>

          <!-- Количество гостей -->
          <div class="guests-input-container">
            <input type="text" class="sfl-guests-input" readonly id="guestsInput" pattern="[0-9]*" value="Нужно на 2">
            <div class="guests-input-container-button">
              <button onclick="updateGuests(-1)">-</button>
              <button onclick="updateGuests(1)">+</button>
            </div>
          </div>

          <!-- Кнопка отправки формы -->
          <div class="sf-submit-button-container">
            <form id="search-form" th:action="@{/hotels/search}" method="post">
              <input type="hidden" id="cityInput" name="city">
              <input type="button" class="sfl-submit-button" value="Найти номер" onclick="submitForm()">
            </form>
          </div>

        </div>
      </div>
    </div>
  </div>

  <!-- Список отелей -->
 <style>
  .hotel-section {
    display: flex;
    gap: 20px; /* отступ между колонками */
    padding: 15px 0;
    border-bottom: 1px solid #ccc;
  }

  .hotel-photos {
    flex: 1; /* 1 часть */
    max-width: 400px; /* или нужная ширина для фото */
  }

  .hotel-info {
    flex: 2; /* 2 части */
    display: flex;
    flex-direction: column;
    max-width: 500px;
  }

  .hotel-address {
    margin-bottom: 10px;
  }

  .hotel-services {
    margin-top: 10px;
  }

  .hotel-price {
    flex: 1; /* 1 часть */
    text-align: center; /* цену и оценку выравниваем по правому краю */
  }

  
</style>

<div class="container">
  <h2>Список отелей</h2>
  <div>
  <!-- Кнопка добавления нового отеля (для администраторов) -->
  <a th:href="@{'/hotels/new'}" th:if="${roles.contains('ROLE_ADMIN')}" class="btn btn-success mt-3">Добавить новый отель</a>
</div>

  <div th:each="hotel, stat : ${hotels}" class="hotel-section" 
       itemscope itemtype="https://schema.org/Hotel"
       th:attr="onclick=|handleClick(event, '${hotel.id}')|" 
       style="cursor: pointer; user-select: text;">

    <!-- Колонка 1: Фотографии -->
    <div class="hotel-photos" onclick="event.stopPropagation();">
      <div class="photo-carousel">
        <div class="photo-container">
          <div th:each="photo : ${hotel.photos}" 
               th:data-photo="@{'/uploads/hotel-' + ${hotel.id} + '/' + ${photo}}">
            <img th:src="@{'/uploads/hotel-' + ${hotel.id} + '/' + ${photo}}" alt="Hotel Photo" style="width:100%; height:auto;"/>
          </div>
        </div>
        <div class="arrow left" th:data-hotel-id="${hotel.id}" th:data-total-photos="${hotel.photos.size()}"
          th:onclick="'showPrevPhoto(this, \'' + ${hotel.id} + '\')'">&lt;</div>
        <div class="arrow right" th:data-hotel-id="${hotel.id}" th:data-total-photos="${hotel.photos.size()}"
          th:onclick="'showNextPhoto(this, \'' + ${hotel.id} + '\')'">&gt;</div>
      </div>
    </div>

    <!-- Колонка 2: Адрес + услуги -->
    <div class="hotel-info">
      <div class="hotel-address">
        <h3 th:text="${hotel.name}"></h3>
        <p th:text="${hotel.country + ', ' + hotel.city + ', ' + hotel.street + ', ' + hotel.house}"></p>
      </div>

      <div class="hotel-services">
        <h4>Доступные услуги</h4>
        <ul class="service-list" 
            th:if="${hotelServicesMap[hotel.id] != null and !hotelServicesMap[hotel.id].isEmpty()}">
          <li th:each="service : ${hotelServicesMap[hotel.id]}" th:text="${service.name}">Название услуги</li>
        </ul>
        <p th:if="${hotelServicesMap[hotel.id] == null or hotelServicesMap[hotel.id].isEmpty()}">Услуги отсутствуют</p>
      </div>

        <!-- Действия для администраторов -->
      <div class="actions">
        <a th:href="@{'/hotels/details/' + ${hotel.id}}" class="btn btn-info btn-sm" th:if="${roles.contains('ROLE_ADMIN')}">Подробнее</a>
        <a th:href="@{'/hotels/edit/' + ${hotel.id}}" class="btn btn-warning btn-sm" th:if="${roles.contains('ROLE_ADMIN')}">Редактировать</a>
        <a th:href="@{'/hotels/delete/' + ${hotel.id}}" class="btn btn-danger btn-sm" th:if="${roles.contains('ROLE_ADMIN')}">Удалить</a>
      </div>
    </div>

    <!-- Колонка 3: Цена и оценка -->
    <div class="hotel-price">
      
      <div class="price-bottom">
        <h4>Цена от</h4>
        <div th:each="room : ${rooms[stat.index]}">
          <h3 th:text="${room.price}"></h3>
        </div>
      </div>

      <div class="rating-box" style="margin-top: 20px;">
        <span th:if="${averageEvaluation[hotel.id] != null and averageEvaluation[hotel.id] > 0}">
          Средняя оценка: 
          <span th:text="${#numbers.formatDecimal(averageEvaluation[hotel.id], 1, 1)}">0.0</span>
          <!-- Здесь можно добавить иконки звезд, если надо -->
        </span>
      </div>
    </div>

    

  </div>

  </div>


 
  <!-- Подключаем дополнительные скрипты -->
 
  <script src="/public/js/hotel.js"></script>
  <!--  <script th:src="@{public/js/hotel.js}"></script> -->
 
    <!-- Подвал  оjs влияет-->
<iframe id="footer-frame" th:src="@{/footer}" width="100%" style="border: none; display: block; margin-top: 40px;"></iframe>
<!-- JS скрипты -->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.0.8/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script src="/public/js/scripts.js"></script>


</body>

</html>